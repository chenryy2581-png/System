<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>點貨系統 (Firebase 版)</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007bff">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { text-align: center; }
    h3.displayBox { text-align: center; font-size: 22px; color: #007bff; margin: 8px 0; }
    label { display: block; margin: 10px 0 6px; }
    select, input, button {
      width: 100%; padding: 10px; font-size: 16px; margin-bottom: 14px;
      border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box;
    }
    button { cursor: pointer; }
    .btn-primary { background: #007bff; color: #fff; border: none; }
    .btn-danger  { background: #dc3545; color: #fff; border: none; }
    .btn-toggle  { background: #28a745; color: #fff; border: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>
  <h2>📦 點貨系統 (Firebase)</h2>

  <h3 class="displayBox">🚚 當前司機：<span id="driverDisplay">尚未設定</span></h3>
  <h3 class="displayBox">🐟 當前魚種：<span id="fishDisplay">尚未設定</span></h3>

  <form id="form">
    <label>🚚 司機</label>
    <select id="currentDriver">
      <option value="">請選擇</option>
      <option>蘇德村</option><option>蘇恩田</option>
      <option>李育銘</option><option>柯嘉雄</option>
      <option>外車1</option><option>外車2</option><option>外車3</option>
    </select>

    <label>🐟 魚種</label>
    <select id="currentFish">
      <option value="">請選擇</option>
      <option>金目</option><option>加州</option><option>七星</option>
      <option>紅尼</option><option>龍虎</option>
    </select>

    <label>📍 據點</label>
    <select id="location">
      <option value="">請選擇</option>
      <option>台北</option><option>基隆</option><option>三重</option><option>桃園</option>
      <option>中壢o</option><option>中壢x</option>
    </select>

    <label>🪵 棧板編號</label>
    <input type="number" id="pallet" placeholder="例如：1" inputmode="numeric">

    <label>⚖️ 規格 (尾/箱)</label>
    <input type="number" id="spec" placeholder="例如：6" inputmode="numeric">

    <label>📦 箱數</label>
    <input type="number" id="box" placeholder="輸入箱數" inputmode="numeric">

    <button type="submit" class="btn-primary">送出</button>
  </form>

  <h3>📋 已送出的資料</h3>
  <ul id="dataList"></ul>

  <!-- ✅ Firebase 連接 -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 🔑 Firebase 設定
    const firebaseConfig = {
      apiKey: "AIzaSyDyzfiGBBfkIYUp_xKykdncocJJwLTnqMs",
      authDomain: "cargosystem-56b91.firebaseapp.com",
      projectId: "cargosystem-56b91",
      storageBucket: "cargosystem-56b91.firebasestorage.app",
      messagingSenderId: "150281096087",
      appId: "1:150281096087:web:96b16f96f6f5887f2692d2",
      measurementId: "G-TLMZFMZW4K"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const form = document.getElementById("form");
    const dataList = document.getElementById("dataList");

    // 📤 表單送出 → 寫入 Firestore
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        driver: document.getElementById("currentDriver").value,
        fish: document.getElementById("currentFish").value,
        location: document.getElementById("location").value,
        pallet: document.getElementById("pallet").value,
        spec: document.getElementById("spec").value,
        box: document.getElementById("box").value,
        createdAt: new Date()
      };

      await addDoc(collection(db, "cargoData"), data);
      alert("✅ 已同步到 Firebase！");

      loadData(); // 送出後重新載入
      form.reset();
    });

    // 📥 讀取 Firestore
    async function loadData() {
      dataList.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "cargoData"));
      querySnapshot.forEach((doc) => {
        const d = doc.data();
        const li = document.createElement("li");
        li.textContent = `${d.driver} | ${d.fish} | ${d.location} | 規格:${d.spec} | 箱:${d.box}`;
        dataList.appendChild(li);
      });
    }

    loadData(); // 頁面載入時讀取
  </script>
</body>
</html>
